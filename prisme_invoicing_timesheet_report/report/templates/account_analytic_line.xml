<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<report id="report_account_analytic_line" model="account.analytic.line"
			string="Prisme Checklist heures" report_type="qweb-pdf"
			name="prisme_timesheet_enhancement.report_account_analytic_line_view"
			file="prisme_timesheet_enhancement.report_account_analytic_line" />

		<!-- paper format is in hr_timesheet_sheet_check report template -->
		<record id="report_account_analytic_line" model="ir.actions.report.xml">
			<field name="paperformat_id" ref="paperformat_landscape" />
		</record>

		<template id="report_account_analytic_line_view">
			<t t-name="prisme_timesheet_enhancement.report_account_analytic_line_view">
				<t t-call="report.html_container">
					<t t-call="report.external_layout">
						<div class="page">
							<t t-set="header" t-value="docs.getHeaderList()"/>
							<table style="font-family: verdana,arial,sans-serif; font-size: 11px; color:#333333; border-width: 1px; border-color: #666666; border-style: solid; margin-left:35%; margin-right:35%;"
									width="30%">
								<tr>
									<td style="text-align: center; font-weight: bold;">Total des Heures</td>
									<td></td>
								</tr>
								<tr>
									<td style="text-align: center; font-weight: bold;"><t t-esc="header[0]"/></td>
									<td style="text-align: right; font-weight: bold;"><t t-esc="header[1]"/></td>
								</tr>
							</table>
							<p>&#160;</p>
							<table style="font-family: verdana,arial,sans-serif; font-size: 9px; color:#333333; border-width: 1px; border-color: #666666; border-style: solid; page-break-after: always; margin-left:35%; margin-right:35%;"
									width="30%">
								<t t-foreach="header[2]" t-as="project">
									<tr>
										<td style="text-align: left;"><t t-esc="project[0]"/></td>
										<td style="text-align: right;"><t t-esc="'%.2f'% project[1]"/></td>
									</tr>
								</t>
								<tr style="border-top: 1px #666666 solid;">
									<td style="text-align: left;">TOTAL</td>
									<td style="text-align: right;"><t t-esc="'%.2f'% header[3]"/></td>
								</tr>
								<tr style="border-top: 1px #666666 solid;">
									<td style="text-align: left;">HEURES DE LA PERIODE</td>
									<td style="text-align: right;"><t t-esc="'%.2f'% header[4]"/></td>
								</tr>
								<tr style="font-weight: bold; border-top: 1px #666666 solid;">
									<td style="text-align: left;">BONUS/MALUS</td>
									<td style="text-align: right;"><t t-esc="'%.2f'% (header[3]-header[4])"/></td>
								</tr>
							</table>
							
							<t t-foreach="docs.getSortedList()" t-as="project">
								<table
									style="font-family: verdana,arial,sans-serif; font-size: 9px; color:#333333; border-width: 1px; border-color: #666666; border-collapse: collapse; page-break-after: always;"
									width="100%">
									<tr style="border-left: 1px solid #666666; border-right: 1px solid #666666; border-top: 1px solid #666666; padding: 1px;">
										<td><b>Client :</b></td>
										<td><b><span t-esc="project['client']" /></b></td>
										<td><b><span t-esc="project['user']" /></b></td>
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td></td>
									</tr>
									<tr style="border-left: 1px solid #666666; border-right: 1px solid #666666; padding: 1px;">
										<td><b>Projet :</b></td>
										<td><b><span t-esc="project['project']" /></b></td>
										<td><b><span t-esc="project['month']" /></b></td>
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td></td>
									</tr>
									<tr>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #dedede;">Description du travail</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #dedede;">Tâche</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #dedede;"
											width="7%">Date</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #dedede;">Déb</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #dedede;">Fin</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #dedede;">Total</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #dedede;">Facturable</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #dedede;">Net</td>
									</tr>


									<t t-foreach="project['timesheets']" t-as="doc">
										<tr>
											<td
												style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
												<span t-field="doc.name" />
											</td>
											<td
												style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
												<span t-field="doc.task_id.name" />
											</td>
											<td
												style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
												<span t-field="doc.date" />
											</td>
											<td
												style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
												<span t-esc="'%.2f'% (doc.time_beginning)" />
											</td>
											<td
												style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
												<span t-esc="'%.2f'% (doc.time_end)" />
											</td>
											<td
												style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
												<span t-esc="'%.2f'% (doc.unit_amount)" />
											</td>
											<td
												style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
												<span t-field="doc.to_invoice.name" />
											</td>
											<td
												style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
												<span
													t-esc="'%.2f'% (doc.unit_amount-((doc.to_invoice.factor*doc.unit_amount)/100.0))" />
											</td>
										</tr>
									</t>

									<tr>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
										</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
										</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
										</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
										</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
										</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
											<b>
												<span t-esc="'%.2f'% project['total_hours']" />
											</b>
										</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
										</td>
										<td
											style="	border-width: 1px; padding: 1px; border-style: solid; border-color: #666666; background-color: #ffffff;">
											<b>
												<span t-esc="'%.2f'% project['net_hours']" />
											</b>
										</td>
									</tr>
								</table>
							</t>
						</div>
					</t>
				</t>
			</t>
		</template>

	</data>
</openerp>